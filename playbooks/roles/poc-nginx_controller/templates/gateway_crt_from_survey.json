{
  "metadata": {
    "name": "gw_{{extra_app.name | lower}}",
    "displayName": "Gateways {{extra_app.name | lower}}",
    "description": "Generated by CMP"
  },
  "desiredState": {
    "ingress": {
      {%- if extra_app_tls_key is defined -%}
      "tls": {
        "certRef": {
          "ref": "/services/environments/{{ var_env_prefix }}{{ extra_app.environment | lower }}/certs/crt_{{ extra_app.name | lower }}"
        }
      },
      {%- endif -%}
      "uris": {
      {%- if extra_app_tls_key is defined %}
        "https://{{extra_app.name | lower}}.{{extra_app.domain | lower}}": {
      {%- else %}
        "http://{{extra_app.name | lower}}.{{extra_app.domain | lower}}": {
      {%- endif %}
          "matchMethod": "EXACT"
        }
      },
      "placement": {
        "instanceRefs": [
          {%- for gw in var_instance_ids -%}
          {
            "ref": "{{ gw.ref }}"
          }{%- if not loop.last -%},{% endif %}
          {%- endfor -%}
        ]
      }
    }
  }
}
